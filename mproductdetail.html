<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product</title>

    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

</head>

<body>
    <a href="#" onclick="history.back()">Regresar</a>
    <div id="containerProduct">

    </div>
    <fieldset>
        <legend>Buscar</legend>
        <input type="text" id="patternText" onkeyup="domContentLoad(dataJSON)" />
        <input type="submit" id="submitButton" />
    </fieldset>

    <table width="100%" id="dataTable">
        <tr>
            <td>Column Id</td>
            <td>Column Icon</td>
            <td>Column Name</td>
            <td>Column Description</td>
            <td>Column urlImg</td>
            <td>Column eGender</td>
            <td>Column Id Category</td>
            <td>Column Id MaterialType</td>
            <td>Column Icon Update</td>
            <td>Column Icon Delete</td>
        </tr>
    </table>
    
    <div id="addDiv">
        <span class="material-symbols-outlined">
            add
        </span>
        </a>
    </div>
    <script>
        const redirectRoot = "mproductdetail.html"
        const urlSearchParams = new URLSearchParams(window.location.search);
        const filter = Boolean(urlSearchParams.get("filter"));
        const id = urlSearchParams.get("id");        

        const moduleEdit = "meproductdetail.html";

        const addDiv = document.getElementById("addDiv");
        const linkAdd = document.createElement("a");
        
        linkAdd.href = moduleEdit +"?id="+ id + "&action=add";
        linkAdd.textContent = "Agregar Elemento";
        addDiv.appendChild(linkAdd);

        loadJSON();

        console.log(id);

        let dataJSON = null;



        async function loadJSON() {
            try {
                const response = await fetch(`http://localhost:8080/api/productDetail/search/${id}`);
                const data = await response.json();
                dataJSON = data;
                document.addEventListener("DOMContentLoaded", domContentLoad(data));
            }
            catch (error) {
                console.log(error);
            }
        }
        function initComponents() {
            const dataTable = document.getElementById("dataTable");
            const patternText = document.getElementById("patternText");

        }

        function domContentLoad(data) {
            console.log(data);
            cleanTable();
            initComponents();
            headerProduct();
            for (var i in data) {

                if (JSON.stringify(data[i].description).includes(patternText.value) || patternText.value == "") {
                    
                    console.log(data);
                    
                    const row = document.createElement("tr");
                    const colId = document.createElement("td");
                    colId.textContent = data[i].id;
                   
                    const colIcon = document.createElement("td");
                    const iconSpan = document.createElement("span");
                    iconSpan.classList.add("material-symbols-outlined");
                    iconSpan.textContent = data[i].icon;
                    colIcon.appendChild(iconSpan);

                    const colDescription = document.createElement("td");
                    colDescription.textContent = data[i].description;

                    const colPurchasePrice = document.createElement("td");
                    colPurchasePrice.textContent = data[i].purchasePrice;

                    const colSalePrice = document.createElement("td");
                    colSalePrice.textContent = data[i].salePrice;

                    const colStock = document.createElement("td");
                    colStock.textContent = data[i].stock;

                    const colColor = document.createElement("td");
                    colColor.textContent = data[i].color.name;

                    const colSize = document.createElement("td");
                    colSize.textContent = data[i].size.name;

                    const colLocation = document.createElement("td");
                    colLocation.textContent = data[i].location.name;

                    const colStatus = document.createElement("td");
                    colStatus.textContent = data[i].status.name;

                    const colUpdate = document.createElement("td");
                    const updateSpan = document.createElement("span");
                    updateSpan.classList.add("material-symbols-outlined");
                    updateSpan.textContent = data[i].updateField;
                    
                    const updateA = document.createElement("a");
                    updateA.setAttribute("href", `meproductDetail.html?id=${data[i].id}`);
                    updateA.appendChild(updateSpan);
                    
                    colUpdate.appendChild(updateA);

                    const colDelete = document.createElement("td");
                    const deleteSpan = document.createElement("span");
                    deleteSpan.classList.add("material-symbols-outlined");
                    deleteSpan.style.cursor = "pointer";
                    deleteSpan.textContent = data[i].deleteField;
                    deleteSpan.id = data[i].id;

                    deleteSpan.addEventListener("click", function (event) {
                        deleteItem(deleteSpan.id);
                    }, false);

                    colDelete.appendChild(deleteSpan);
                    
                    row.appendChild(colId);
                    row.appendChild(colIcon);
                    row.appendChild(colDescription);
                    row.appendChild(colPurchasePrice);
                    row.appendChild(colSalePrice);
                    row.appendChild(colStock);
                    row.appendChild(colColor);
                    row.appendChild(colSize);
                    row.appendChild(colLocation);
                    row.appendChild(colStatus);
                    row.appendChild(colUpdate);
                    row.appendChild(colDelete);

                    dataTable.appendChild(row);
                }
            }
        }

        function headerProduct(){
            const containerProduct = document.getElementById("containerProduct");

            const image = document.createElement("img");
            image.src = `assets/${dataJSON[0].product.urlImg}`;

            const divName = document.createElement("div");
            divName.textContent = `Nombre: ${dataJSON[0].product.name}`;
            
            const divDescription = document.createElement("div");
            divDescription.textContent = `Descripci√≥n : ${dataJSON[0].product.description}`;
        
            const divGender = document.createElement("div");
            divGender.textContent = `Genero : ${dataJSON[0].product.gender.name}`;
            
            containerProduct.appendChild(image);
            containerProduct.appendChild(divName);
            containerProduct.appendChild(divDescription);
            containerProduct.appendChild(divGender);
        }

        function cleanTable() {
            dataTable.innerHTML = "";
        }
        async function deleteItem(id) {
            console.log(id);
            const response = await fetch(`http://localhost:8080/api/productDetail/${id}`, {
                method: 'DELETE'
            });
            location.reload();
        }

    </script>
</body>
</html>